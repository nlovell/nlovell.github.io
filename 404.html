<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>404 Not Found</title>
  </head>
  <body>
    <script>
      window.onload = () => {
        const url = new URL(window.location.href);

        function render404(extra) {
          // Clear body
          document.body.innerHTML = '';
          const h1 = document.createElement('h1');
          h1.textContent = '404 - Page Not Found';
          const p = document.createElement('p');
          p.textContent = 'The page could not be found.';
          document.body.appendChild(h1);
          document.body.appendChild(p);
          if (extra) {
            const p2 = document.createElement('p');
            p2.innerHTML = extra;
            document.body.appendChild(p2);
          }
        }

        // Check if already redirected
        if (url.searchParams.get('lcr') === 'true') {
          render404();
          return;
        }

        // Generate lowercase version of full URL (path + search + hash)
        const lowerHref = (
          url.origin + url.pathname.toLowerCase() +
          url.search.toLowerCase() +
          url.hash.toLowerCase()
        );

        // Append the lcr flag
        const separator = lowerHref.includes('?') ? '&' : '?';
        const redirectURL = `${lowerHref}${separator}lcr=true`;

        // Only redirect if the current URL is not already lowercase
        if (window.location.href !== redirectURL) {
          window.location.replace(redirectURL);
        } else {
          // If somehow already lowercased and still 404, show fallback
          const altUrl = `${url.origin}/r${url.pathname}`;
          render404(`This may be a redirect that has moved. Try <a href="${altUrl}">${altUrl}</a>`);
        }
      };
    </script>
  </body>
</html>
